### Hooks FAQ

Hooks æ˜¯ React 16.8 å¼•å…¥çš„æ–°å†…å®¹ã€‚å®ƒä»¬å…è®¸ä½ ä¸å†™ä¸€ä¸ªç±»æ¥ä½¿ç”¨çŠ¶æ€å’Œå…¶ä»– React åŠŸèƒ½ã€‚


### å¼•å…¥ç­–ç•¥

#### å“ªä¸€ä¸ªç‰ˆæœ¬çš„ React åŒ…å« Hooksï¼Ÿ

å¼€å§‹äº 16.8.0ï¼ŒReact åŒ…å«ä¸€ä¸ªç¨³å®šçš„ React Hooks å®ç°ï¼š

- React DOM
- React Native
- React DOM Server
- React Test Renderer
- React Shallow Renderer

æ³¨æ„å»å¯ç”¨ Hooksï¼Œæ‰€æœ‰çš„ React åŒ…éœ€è¦æ˜¯ 16.8.0 æˆ–è€…æ›´é«˜ã€‚Hooks å°†ä¸ä¼šå·¥ä½œï¼Œå¦‚æœä½ å¿˜è®°å»æ›´æ–°ï¼Œæ¯”å¦‚ï¼ŒReact DOMã€‚

React Native 0.59 ä¹‹ä¸Šæ”¯æŒ Hooksã€‚

#### æˆ‘éœ€è¦é‡å†™æˆ‘çš„æ‰€æœ‰ç±»ç»„ä»¶ï¼Ÿ

ä¸ï¼Œæ²¡æœ‰ä» React ç§»é™¤ç±»çš„è®¡åˆ’ -- æˆ‘ä»¬éƒ½éœ€è¦ä¿æŒäº§å“è¿è¾“å¹¶ä¸”ä¸èƒ½æ‰¿å—é‡å†™ã€‚æˆ‘ä»¬æ¨èåœ¨æ–°ä»£ç å°è¯• Hooksã€‚

#### æˆ‘å¯ä»¥ä½¿ç”¨ Hooks åšåˆ°ä»€ä¹ˆæˆ‘æ— æ³•ä½¿ç”¨ç±»åšåˆ°çš„ï¼Ÿ

Hooks æä¾›ä¸€ä¸ªå¼ºå¤§å’Œè¡¨è¾¾çš„æ–°æ–¹å¼åœ¨ç»„ä»¶é—´å»é‡ç”¨åŠŸèƒ½ï¼Œ"æ„å»ºä½ è‡ªå·±çš„ Hooks"æä¾›ä¸€ä¸ªå¯èƒ½çš„æ¦‚è¿°ã€‚React æ ¸å¿ƒå›¢é˜Ÿæˆå‘˜æä¾›çš„è¿™ä¸ªæ–‡ç« æ·±å…¥è§£æ Hooks è§£é”çš„æ–°èƒ½åŠ›ã€‚

#### æˆ‘çš„å¤šå°‘ React çŸ¥è¯†è¿˜ä¿ç•™ï¼Ÿ
Hooks æ˜¯ä¸€ä¸ªæ›´åŠ ç›´æ¥çš„æ–¹å¼å»ä½¿ç”¨ä½ å·²ç»çŸ¥é“çš„ React åŠŸèƒ½ -- æ¯”å¦‚çŠ¶æ€ï¼Œç”Ÿå‘½å‘¨æœŸï¼Œä¸Šä¸‹æ–‡ï¼Œå’Œ refsã€‚ä»–ä»¬æ²¡æœ‰ä»æ ¹æœ¬ä¸Šæ”¹å˜ React çš„å·¥ä½œæ–¹å¼ï¼Œå¹¶ä¸”ä½ å…³äº componentï¼Œpropsï¼Œå’Œè‡ªé¡¶å‘ä¸‹æ•°æ®æµçš„åªæ˜¯éƒ½ä¿ç•™ç€ã€‚

Hooks çš„ç¡®æœ‰è‡ªå·±çš„å­¦ä¹ æ›²çº¿ã€‚å¦‚æœæœ‰ä»€ä¹ˆåœ¨è¿™ä¸ªæ–‡æ¡£ç¼ºå¤±ï¼Œæå‡ºä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¼šå°è¯•å»å¸®åŠ©ã€‚

#### æˆ‘åº”è¯¥ä½¿ç”¨ Hooksï¼Œç±»ï¼Œæˆ–è€…æ··åˆä»–ä»¬ï¼Ÿ

å½“ä½ å‡†å¤‡å¥½ï¼Œæˆ‘ä»¬é¼“åŠ±ä½ å»å¼€å§‹åœ¨ä½ å†™çš„æ–°ç»„ä»¶å°è¯• Hooksã€‚ç¡®ä¿ä½ å›¢é˜Ÿçš„æ¯ä¸€ä¸ªäººä½¿ç”¨ä»–ä»¬ï¼Œå¹¶ç†Ÿæ‚‰è¿™ä¸ªæ–‡æ¡£ã€‚æˆ‘ä»¬ä¸æ¨èé‡å†™ä½ å·²ç»å­˜åœ¨çš„ç±»åˆ° Hooks çŸ¥é“ä½ è®¡åˆ’å»é‡å†™ä»–ä»¬ï¼ˆæ¯”å¦‚ï¼Œä¿®å¤ bugï¼‰ã€‚

ä½ ä¸èƒ½åœ¨ç±»ç»„ä»¶å†…éƒ¨ä½¿ç”¨ Hooksï¼Œä½†æ˜¯ä½ å¯ä»¥å®šä¹‰æ··åˆç±»å’Œä½¿ç”¨ Hooks çš„å‡½æ•°ç»„ä»¶åœ¨ä¸€ä¸ªå•ç‹¬çš„æ ‘ã€‚æ— è®ºä¸€ä¸ªç»„ä»¶æ˜¯ä¸€ä¸ªç±»æˆ–è€…ä¸€ä¸ªä½¿ç”¨ Hooks çš„å‡½æ•°éƒ½æ˜¯ç»„ä»¶å®ç°çš„ç»†èŠ‚ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬æœŸå¾… Hooks æˆä¸ºçƒ­é—¨ç¼–å†™ React ç»„ä»¶çš„ä¸»è¦æ–¹å¼ã€‚

#### Hooks è¦†ç›–æ‰€æœ‰ç±»çš„ä½¿ç”¨åœºæ™¯å—ï¼Ÿ

æˆ‘ä»¬å¯¹äº Hooks çš„ç›®æ ‡æ˜¯è¦†ç›–ç±»çš„æ‰€æœ‰ä½¿ç”¨åœºæ™¯ï¼Œè¶Šå¿«è¶Šå¥½ã€‚æ²¡æœ‰ Hook å’Œä¸å¸¸ç”¨çš„ `getSnapshotBeforeUpdate`å’Œ`componentDidCatch`ç”Ÿå‘½å‘¨æœŸä¸€æ ·ï¼Œä½†æ˜¯æˆ‘ä»¬è®¡åˆ’å°½å¿«æ·»åŠ ä»–ä»¬ã€‚

è¿™æ˜¯ Hooks çš„æ—©æœŸæ—¶é—´ï¼Œä¸€äº›ç¬¬ä¸‰æ–¹åº“å¯èƒ½è¿˜æ²¡æœ‰å’Œ Hooks å…¼å®¹ã€‚

#### Hooks æ›¿ä»£ render props å’Œ higher-order ç»„ä»¶ï¼Ÿ

é€šå¸¸ï¼Œrender props å’Œ higher-order ç»„ä»¶åªæ¸²æŸ“ä¸€ä¸ªå­ç»„ä»¶ã€‚æˆ‘ä»¬è§‰å¾— Hooksæ˜¯æœåŠ¡äºè¿™ä¸ªä½¿ç”¨åœºæ™¯çš„ç®€å•æ–¹å¼ã€‚ä¾æ—§è¿˜æœ‰ä»–ä»¬è¿™äº›æ¨¡å¼çš„ç”¨å¤„ï¼ˆæ¯”å¦‚ï¼Œä¸€ä¸ªè™šæ‹Ÿæ»šåŠ¨ç»„ä»¶å¯èƒ½å“Ÿä¸€ä¸ª`renderItem`å±æ€§ï¼Œæˆ–è€…å¯è§†å®¹å™¨ç»„ä»¶è‚¯æ©æ›´æœ‰è‡ªå·±çš„ DOM ç»“æ„ï¼‰ã€‚ä½†æ˜¯åœ¨å¤§éƒ¨åˆ†ç”¨åŠ›ï¼ŒHooks è¶³å¤Ÿå¹¶å¯ä»¥å¸®åŠ©å‡å°‘ä½ çš„æ ‘çš„åµŒå¥—ã€‚

#### Hooks å¯¹äºåƒ Redux connect() å’Œ React Router è¿™ç±»æµè¡Œçš„ API æ¥è¯´æ„å‘³ç€å•¥ï¼Ÿ

ä½ å¯ä»¥å’Œå¾€å¸¸ä¸€æ ·ç»§ç»­ä½¿ç”¨å®Œå…¨ç›¸åŒçš„ APIï¼›ä»–ä»¬ä¾æ—§ç»§ç»­å·¥ä½œã€‚

React Redux ä» v7.1.0 æ”¯æŒ Hooks APIï¼Œå¹¶æš´éœ²å‡ºç±»ä¼¼`useDispatch`æˆ–è€…`useSelector`çš„ hookã€‚

React Route ä» v5.1 å¼€å§‹æ”¯æŒ hooksã€‚

å…¶ä»–åº“å¯èƒ½åœ¨æœªæ¥ä¹Ÿæ”¯æŒ hooksã€‚


####  Hooks å’Œé™æ€ç±»å‹ä¸€èµ·ç”¨å—ï¼Ÿ

Hooks åœ¨è®¾è®¡çš„æ—¶å€™è€ƒè™‘äº†é™æ€ç±»å‹ã€‚å› ä¸ºä»–ä»¬æ˜¯å‡½æ•°ï¼Œä»–ä»¬æ¯” higher-order component æ¨¡å¼æ›´å®¹æ˜“è¾“å…¥æ­£ç¡®ã€‚æœ€æ–°çš„ Flow å’Œ TypeScript React å®šä¹‰åŒ…å«å¯¹ React Hooks çš„æ”¯æŒã€‚

é‡è¦çš„æ˜¯ï¼Œè‡ªå®šä¹‰ Hooks ç»™ä½ å»çº¦æŸ React API çš„èƒ½åŠ›ï¼Œå¦‚æœä½ è¦ä»¥æŸç§å½¢å¼çº¦æŸæ›´ä¸¥æ ¼ã€‚React ç»™ä½ è¿™ä¸ªåŸè¯­ï¼Œä½†æ˜¯ä½ å¯ä»¥ä»¥ä¸åŒçš„æ–¹å¼ç»“åˆä»–ä»¬ï¼Œä¸åŒäºæˆ‘ä»¬æä¾›çš„å¼€ç®±å³ç”¨çš„ã€‚

#### æ€ä¹ˆæµ‹è¯•ä½¿ç”¨ Hooks çš„ç»„ä»¶ï¼Ÿ

ä» React çš„è§†è§’æ¥çœ‹ï¼Œä½¿ç”¨ Hooks çš„ç»„ä»¶å°±åªæ˜¯ä¸€ä¸ªå¸¸è§„ç»„ä»¶ã€‚å¦‚æœä½ çš„æµ‹è¯•è§£å†³æ–¹æ¡ˆä¸ä¾èµ– React å†…éƒ¨ï¼Œæµ‹è¯•ä½¿ç”¨ Hooks çš„ç»„ä»¶å’Œæµ‹è¯•æ™®é€šç»„ä»¶æ²¡å•¥åŒºåˆ«ã€‚

> æ³¨æ„ï¼šResting Recipes åŒ…å«å¾ˆå¤šä½ å¯ä»¥å¤åˆ¶ç²˜è´´çš„ä¾‹å­ã€‚

æ¯”å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè®¡æ•°å™¨ç»„ä»¶ï¼š
```jsx harmony
function Example() {
  const [count, setCount] = useState(0);
  useEffect(() => {
    document.title = `You clicked ${count} times`;
  });
  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>
        Click me
      </button>
    </div>
  );
}
```

æˆ‘ä»¬å°†ä½¿ç”¨ React DOM æµ‹è¯•å®ƒã€‚ä¸ºäº†ç¡®ä¿å’Œæµè§ˆå™¨çš„è¡Œæ–‡ä¸€è‡´ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`ReactTestUtils.act()`è°ƒç”¨åŒ…è£¹ä»£ç çš„æ¸²æŸ“å’Œæ›´æ–°ï¼š
```jsx harmony
import React from 'react';
import ReactDOM from 'react-dom';
import { act } from 'react-dom/test-utils';
import Counter from './Counter';

let container;

beforeEach(() => {
  container = document.createElement('div');
  document.body.appendChild(container);
});

afterEach(() => {
  document.body.removeChild(container);
  container = null;
});

it('can render and update a counter', () => {
  // Test first render and effect
  act(() => {
    ReactDOM.render(<Counter />, container);
  });
  const button = container.querySelector('button');
  const label = container.querySelector('p');
  expect(label.textContent).toBe('You clicked 0 times');
  expect(document.title).toBe('You clicked 0 times');

  // Test second render and effect
  act(() => {
    button.dispatchEvent(new MouseEvent('click', {bubbles: true}));
  });
  expect(label.textContent).toBe('You clicked 1 times');
  expect(document.title).toBe('You clicked 1 times');
});
```

`act()`çš„è°ƒç”¨ä¹Ÿå°†ä¼šæ›´æ–°ä»–ä»¬å†…éƒ¨çš„ effectã€‚

å¦‚æœä½ éœ€è¦æµ‹è¯•è‡ªå®šä¹‰ Hookï¼Œä½ å¯ä»¥é€šè¿‡åœ¨ä½ çš„æµ‹è¯•åˆ›å»ºä¸€ä¸ªç»„ä»¶ï¼Œå¹¶åœ¨å®ƒå†…éƒ¨ä½¿ç”¨ Hookã€‚ç„¶åä½ å°±å¯ä»¥æµ‹è¯•ä½ å†™çš„ç»„ä»¶ã€‚

ä¸ºäº†å‡å°‘æ ·æ¿ï¼Œæˆ‘ä»¬æ¨èä½¿ç”¨ React Testing Libraryï¼Œå®ƒä¸ºé¼“åŠ±ä½¿ç”¨ä½ çš„ç»„ä»¶å°±åƒæœ€ç»ˆç”¨æˆ·ä½¿ç”¨ä¸€æ ·å†™æµ‹è¯•è€Œè®¾è®¡ã€‚

äº†è§£æ›´å¤šä¿¡æ¯ï¼ŒæŸ¥é˜… Testing Recipesã€‚


#### lint rule å…·ä½“çº¦æŸä»€ä¹ˆï¼Ÿ

æˆ‘ä»¬æä¾›ä¸€ä¸ª ESLint plugin åº”ç”¨ Hooks çš„è§„åˆ™å»é¿å… bugã€‚å‡è®¾ä»»ä½•å‡½æ•°ä»¥"use"å¼€å¤´å¹¶ä½¿ç”¨å¤§å†™å­—ç¬¦ä½œä¸ºåç»­çš„å¼€å¤´ï¼Œåˆ™è¿™æ˜¯ä¸€ä¸ª Hookã€‚æˆ‘ä»¬å¯å‘å¼çš„è®¤ä¸ºè¿™ä¸æ˜¯æœ€å¥½å¹¶ä¸”å¯èƒ½å­˜åœ¨è¯¯æŠ¥ï¼Œä½†æ˜¯æ²¡æœ‰ä¸€ä¸ªä¸€ä¸ªç”Ÿæ€ç³»ç»Ÿå®½åº¦çš„çº¦å®šï¼Œæ— æ³•è®© Hooks å¥½å¥½å·¥ä½œ -- é•¿åå­—å°†ä¼šé˜»æ­¢äººä»½å¼•å…¥ Hooks æˆ–è€…éµå®ˆçº¦å®šã€‚

ç‰¹åˆ«æ˜¯ï¼Œè§„åˆ™æ‰§è¡Œï¼š
- åœ¨ `PascalCase` å‡½æ•°å†…éƒ¨ï¼ˆå‡è®¾æ˜¯ä¸€ä¸ªç»„ä»¶ï¼‰æˆ–è€…å…¶ä»–`useSomething`å‡½æ•°å†…éƒ¨ï¼ˆå‡è®¾æ˜¯ä¸€ä¸ªè‡ªåŠ¨ä»¥ Hookï¼‰è°ƒç”¨ Hookã€‚
- Hooks åœ¨æ¯æ¬¡æ¸²æŸ“éƒ½ä»¥ç›¸åŒçš„é¡ºåºæ‰§è¡Œã€‚

è¿˜æœ‰ä¸€äº›å¯å‘ï¼Œä»–ä»¬å¯èƒ½éšç€æ—¶é—´æ”¹å˜ï¼Œæˆ‘ä»¬å¯¹è§„åˆ™çš„å¾®è°ƒå»å¹³è¡¡å¯»æ‰¾ bug å’Œé¿å…è¯¯æŠ¥ã€‚

### ä»ç±»åˆ° Hooks

#### ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å’Œ Hooks å¦‚ä½•å¯¹åº”ï¼Ÿ

- `constructor`ï¼šå‡½æ•°ç»„ä»¶ä¸éœ€è¦ä¸€ä¸ªæ„é€ å™¨ã€‚ä½ å¯ä»¥åˆå§‹åŒ–åœ¨`useState`è°ƒç”¨çš„çŠ¶æ€ã€‚å¦‚æœè®¡ç®—åˆå§‹çŠ¶æ€å¾ˆæ˜‚è´µï¼Œä½ å¯ä»¥ä¼ é€’ä¸€ä¸ªå‡½æ•°ç»™`userState`ã€‚

- `getDerivedStateFromProps`ï¼šä½¿ç”¨æ›´æ–°æ—¶æ¸²æŸ“ã€‚

- `shouldComponentUpdate`ï¼šæŸ¥é˜…ä¸‹é¢çš„`React.memo`ã€‚

- `render`ï¼šè¿™å°±æ˜¯å‡½æ•°ç»„ä»¶ä½“æœ¬èº«ã€‚

- `componentDidMount`ï¼Œ`componentDidUpdate`ï¼Œ`componentWillUnmount`ï¼šuseEffect Hook å¯ä»¥è¡¨ç¤ºæ‰€æœ‰çš„ç»“åˆï¼ˆåŒ…å«å°‘é‡å¸¸è§ä¾‹å­ï¼‰ã€‚

- `componentDidCatch`å’Œ`getDerivedStateFromError`ï¼šè¿˜æ²¡æœ‰ Hook å’Œè¿™äº›æ–¹æ³•ç›¸åŒï¼Œä½†æ˜¯ä»–ä»¬é©¬ä¸Šå°±ä¼šè¢«åŠ è¿›æ¥ã€‚

#### Hooks å¦‚ä½•å®ç°æ•°æ®è·å–ï¼Ÿ

è¿™é‡Œæœ‰ä¸€ä¸ªå°ä¾‹å­å»å¼€å§‹ã€‚å­¦ä¹ æ›´å¤šï¼Œå¯ä»¥æŸ¥é˜…è¿™ç¯‡æ–‡ç« å…³äºä½¿ç”¨ Hooks è·å–æ•°æ®ã€‚

#### æœ‰ç±»ä¼¼ instance çš„å˜é‡å—ï¼Ÿ

æ˜¯çš„ï¼`useRef()` Hook ä¸ä»…ä»…æ˜¯ä¸€ä¸ª DOM refsã€‚"ref"å¯¹è±¡æ˜¯ä¸€ä¸ªé€šç”¨å®¹å™¨ï¼Œå®ƒçš„`current`å±æ€§æ˜¯å¯å˜çš„ï¼Œå¹¶ä¸”å¯ä»¥ä¿å­˜ä»»ä½•å€¼ï¼Œå°±åƒç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚

ä½ å¯ä»¥åœ¨`useEffect()`å†…éƒ¨å†™å…¥å®ƒï¼š
```jsx harmony
function Timer() {
  const intervalRef = useRef();

  useEffect(() => {
    const id = setInterval(() => {
      // ...
    });
    intervalRef.current = id;
    return () => {
      clearInterval(intervalRef.current);
    };
  });

  // ...
}
```

å¦‚æœæˆ‘ä»¬æƒ³è¦è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œæˆ‘ä»¬ä¸éœ€è¦è¿™ä¸ª refï¼ˆ`id`å¯ä»¥æ˜¯ effect çš„æœ¬åœ°å˜é‡ï¼‰ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦ä»äº‹ä»¶å¤„ç†å™¨æ¸…ç†å®šæ—¶å™¨ï¼Œå®ƒå°±å¾ˆæœ‰ç”¨ã€‚

æ¦‚å¿µä¸Šï¼Œä½ å¯ä»¥è®¤ä¸º refs å’Œç±»ä¸­çš„å®ä¾‹å˜é‡ä¸€æ ·ã€‚é™¤éä½ ä½¿ç”¨ lazy initializationï¼Œé¿å…åœ¨æ¸²æŸ“çš„æ—¶å€™è®¾ç½® refs -- è¿™ä¼šå¯¼è‡´æƒŠå–œçš„è¡Œä¸ºã€‚ç›¸åï¼Œé€šå¸¸ä½ è¦åœ¨äº‹ä»¶å¤„ç†å™¨å’Œ effect ä¿®æ”¹ refsã€‚

#### åº”è¯¥ä½¿ç”¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªçŠ¶æ€å˜é‡ï¼Ÿ

å¦‚æœä½ ä» class æ¥çš„ï¼Œä½ å¯èƒ½ä¼šå°è¯•æ€»æ˜¯è°ƒç”¨`useState`ä¸€æ¬¡æ”¾å…¥æ‰€æœ‰çš„çŠ¶æ€åˆ°ä¸€ä¸ªå•ç‹¬çš„å¯¹è±¡ã€‚ä½ å¯ä»¥æŒ‰ä½ å–œæ¬¢çš„åšã€‚è¿™æ˜¯ä¸€ä¸ªç»„ä»¶è·Ÿéšé¼ æ ‡ç§»åŠ¨çš„ä¾‹å­ã€‚æˆ‘ä»¬ä¿å­˜å®ƒçš„å®šä½å’Œå¤§å°åœ¨æœ¬åœ°çŠ¶æ€:
```jsx harmony
function Box() {
  const [state, setState] = useState({ left: 0, top: 0, width: 100, height: 100 });
  // ...
}
```

ç°åœ¨ï¼Œå‡è®¾æˆ‘ä»¬æƒ³è¦å†™ä¸€äº›é€»è¾‘æ”¹å˜`left`å’Œ`top`ï¼Œå½“ç”¨æˆ·ç§»åŠ¨ä»–ä»¬çš„é¼ æ ‡çš„æ—¶å€™ã€‚æ³¨æ„æˆ‘ä»¬æ˜¯æ€æ ·å¿…é¡»å»æ‰‹åŠ¨åˆå¹¶è¿™äº›åŸŸå’Œä¹‹å‰çš„çŠ¶æ€å¯¹è±¡çš„ï¼š
```jsx harmony
  // ...
  useEffect(() => {
    function handleWindowMouseMove(e) {
      // Spreading "...state" ensures we don't "lose" width and height
      setState(state => ({ ...state, left: e.pageX, top: e.pageY }));
    }
    // Note: this implementation is a bit simplified
    window.addEventListener('mousemove', handleWindowMouseMove);
    return () => window.removeEventListener('mousemove', handleWindowMouseMove);
  }, []);
  // ...
```

è¿™æ˜¯å› ä¸ºå½“æˆ‘é¥¿ä»¬æ›´æ–°çŠ¶æ€å˜é‡çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ›¿æ¢å®ƒçš„å€¼ã€‚è¿™å’Œç±»ä¸­çš„`this.setState`ä¸åŒï¼Œå®ƒåˆå¹¶æ›´æ–°çš„åŸŸåˆ°å¯¹è±¡ä¸­ã€‚

å¦‚æœä½ æƒ³å¿µè‡ªåŠ¨åˆå¹¶ï¼Œä½ å¯ä»¥å†™ä¸€ä¸ªè‡ªå®šä¹‰çš„`useLagacyState` Hookï¼Œåˆå¹¶å¯¹è±¡çŠ¶æ€æ›´æ–°ã€‚ç„¶è€Œï¼Œç›¸åï¼Œ**æˆ‘ä»¬æ¨èå»åˆ†å‰²çŠ¶æ€åˆ°å¤šä¸ªçŠ¶æ€å˜é‡ï¼ŒåŸºäºå“ªäº›å€¼å°†ä¸€èµ·æ”¹å˜**ã€‚

æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†å‰²æˆ‘ä»¬çš„ç»„ä»¶çŠ¶æ€åˆ°`position`å’Œ`size`å¯¹è±¡ï¼Œå¹¶ä¸”æ€»æ˜¯æ›¿æ¢`position`ï¼Œè€Œä¸éœ€è¦åˆå¹¶ã€‚
```jsx harmony
function Box() {
  const [position, setPosition] = useState({ left: 0, top: 0 });
  const [size, setSize] = useState({ width: 100, height: 100 });

  useEffect(() => {
    function handleWindowMouseMove(e) {
      setPosition({ left: e.pageX, top: e.pageY });
    }
    // ...
```
åˆ†ç¦»ç‹¬ç«‹çŠ¶æ€è¾¹é¢†è¿˜æœ‰å…¶ä»–å¥½å¤„ã€‚å®ƒè®©å®ƒå¯ä»¥å¾ˆç®€å•çš„æŠ½å–ä¸€äº›ç›¸å…³é€»è¾‘åˆ°ä¸€ä¸ªè‡ªå®šä¹‰ Hookï¼Œæ¯”å¦‚ï¼š
```jsx harmony
function Box() {
  const position = useWindowPosition();
  const [size, setSize] = useState({ width: 100, height: 100 });
  // ...
}

function useWindowPosition() {
  const [position, setPosition] = useState({ left: 0, top: 0 });
  useEffect(() => {
    // ...
  }, []);
  return position;
}
```
æ³¨æ„æˆ‘ä»¬æ˜¯æ€æ ·ç§»åŠ¨`position`çŠ¶æ€å˜é‡çš„`useState`è°ƒç”¨å’Œç›¸å…³ effect åˆ°ä¸€ä¸ªè‡ªå®šä¹‰ Hook è€Œæ²¡æœ‰æ”¹å˜ä»–ä»¬çš„ä»£ç çš„ã€‚å¦‚æœæ‰€æœ‰çš„çŠ¶æ€éƒ½åœ¨ä¸€ä¸ªå•ä¸€çš„å¯¹è±¡ï¼ŒæŠ½å–ä»–ä»¬å°†æ›´åŠ å›°éš¾ã€‚

å°†æ‰€æœ‰çš„çŠ¶æ€æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„`useState`è°ƒç”¨ï¼Œæˆ–è€…ä¸ºæ¯ä¸€ä¸ªåŸŸéƒ½æœ‰ä¸€ä¸ª`useState`è°ƒç”¨éƒ½è¡Œã€‚ç»„ä»¶è¶‹å‘äºæ˜“è¯»ï¼Œå½“ä½ æ‰¾åˆ°ä¸¤ç§å®è·µä¸­çš„å¹³è¡¡ï¼Œå¹¶åˆ†ç»„ç›¸å…³çŠ¶æ€åˆ°ä¸€äº›ç‹¬ç«‹çš„çŠ¶æ€å˜é‡çš„æ—¶å€™ã€‚å¦‚æœçŠ¶æ€é€»è¾‘å˜å¾—å¤æ‚ï¼Œæˆ‘ä»¬æ¨èä½¿ç”¨ä¸€ä¸ª reducer ç®¡ç†ï¼Œæˆ–è€…ä¸€ä¸ªè‡ªå®šä¹‰ Hookã€‚

#### å¯ä»¥åªåœ¨æ›´æ–°çš„æ—¶å€™æ‰§è¡Œ effect å—ï¼Ÿ

è¿™æ˜¯ä¸€ä¸ªç½•è§çš„ä¾‹å­ã€‚å¦‚æœä½ éœ€è¦å®ƒï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå¯å˜ ref å»æ‰‹åŠ¨å­˜å‚¨ä¸€ä¸ªå¸ƒå°”å€¼è¡¨ç¤ºä½ æ˜¯å¦åœ¨ç¬¬ä¸€æ¬¡æˆ–è€…åç»­æ¸²æŸ“ï¼Œç„¶ååœ¨ä½ çš„ effect æ£€æŸ¥è¿™ä¸ªæ ‡ç¤ºï¼ˆå¦‚æœä½ å‘ç°ä½ ç»å¸¸è¿™ä¹ˆåšï¼Œä½ å¯ä»¥ä¸ºä»–åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ Hookï¼‰ã€‚

#### æ€ä¹ˆè·å–å‰ä¸€ä¸ª props æˆ–è€… stateï¼Ÿ

ç°åœ¨ï¼Œä½ å¯ä»¥æ‰‹åŠ¨ä½¿ç”¨ ref æ¥å®Œæˆã€‚
```jsx harmony
function Counter() {
  const [count, setCount] = useState(0);

  const prevCountRef = useRef();
  useEffect(() => {
    prevCountRef.current = count;
  });
  const prevCount = prevCountRef.current;

  return <h1>Now: {count}, before: {prevCount}</h1>;
}
```

```jsx harmony
function Counter() {
  const [count, setCount] = useState(0);

  const prevCountRef = useRef();
  useEffect(() => {
    prevCountRef.current = count;
  });
  const prevCount = prevCountRef.current;

  return <h1>Now: {count}, before: {prevCount}</h1>;
}

```

è¿™å¯èƒ½æœ‰ç‚¹å¤æ‚ï¼Œä½†æ˜¯ä½ å¯ä»¥æŠ½å–åˆ°ä¸€ä¸ªè‡ªå®šä¹‰ Hookï¼š
```jsx harmony
function Counter() {
  const [count, setCount] = useState(0);
  const prevCount = usePrevious(count);
  return <h1>Now: {count}, before: {prevCount}</h1>;
}

function usePrevious(value) {
  const ref = useRef();
  useEffect(() => {
    ref.current = value;
  });
  return ref.current;
}
```
æ³¨æ„å®ƒæ˜¯æ€æ ·ä¸º propsï¼Œstateï¼Œæˆ–è€…å…¶ä»–è®¡ç®—å€¼ç”Ÿæ•ˆçš„ã€‚
```jsx harmony
function Counter() {
  const [count, setCount] = useState(0);

  const calculation = count + 100;
  const prevCalculation = usePrevious(calculation);
  // ...

```
æœªæ¥ React å¯èƒ½ä¼šæä¾›ä¸€ä¸ªå¼€ç®±å³ç”¨çš„`userPrevious` Hookï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„åœºæ™¯ã€‚

åŒæ—¶æŸ¥é˜…åˆ†å‘çŠ¶æ€çš„æ¨èæ¨¡å¼ã€‚

#### ä¸ºä»€ä¹ˆåœ¨å‡½æ•°å†…éƒ¨çœ‹åˆ°ä¸æ–°é²œçš„å±æ€§æˆ–è€…çŠ¶æ€ï¼Ÿ

ä»»ä½•ç»„ä»¶å†…çš„å‡½æ•°ï¼ŒåŒ…æ‹¬äº‹ä»¶å¤„ç†å™¨å’Œ effectï¼Œéƒ½å¯ä»¥ä»åˆ›å»ºå®ƒçš„æ¸²æŸ“è€…"çœ‹åˆ°" props å’Œ stateã€‚æ¯”å¦‚ï¼Œè€ƒè™‘è¿™æ ·çš„ä»£ç ï¼š
```jsx harmony
function Example() {
  const [count, setCount] = useState(0);

  function handleAlertClick() {
    setTimeout(() => {
      alert('You clicked on: ' + count);
    }, 3000);
  }

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>
        Click me
      </button>
      <button onClick={handleAlertClick}>
        Show alert
      </button>
    </div>
  );
}
```
å¦‚æœä½ ç¬¬ä¸€æ¬¡ç‚¹å‡»"Show Alert"ï¼Œç„¶åå¢åŠ è®¡æ•°å™¨ï¼Œalert å°†ä¼šæ˜¾ç¤º**ä½ ç‚¹å‡»"Show alert"æŒ‰é’®æ—¶çš„**`count`å˜é‡ã€‚è¿™é˜²æ­¢å› ä¸º props å’Œ state ä¸æ”¹å˜çš„ bugã€‚

å¦‚æœä½ æƒ³è¦ä»å¼‚æ­¥å›è°ƒè¯»å–æœ€æ–°çš„çŠ¶æ€ï¼Œä½ å¯ä»¥ä¿å­˜å®ƒåˆ°ä¸€ä¸ª refï¼Œæ”¹å˜å®ƒï¼Œç„¶åä»å®ƒé‚£é‡Œè¯»å–ã€‚

æœ€åï¼Œä½ çœ‹åˆ°ä¸æ–°é²œçš„ props æˆ–è€… state çš„å…¶ä»–å¯èƒ½çš„åŸå› æ˜¯å¦‚æœä½ ä½¿ç”¨"ä¾èµ–æ•°ç»„"ä¼˜åŒ–ï¼Œä½†æ˜¯ä¸æ­£ç¡®çš„æŒ‡å®šæ‰€æœ‰çš„ä¾èµ–ã€‚æ¯”å¦‚ï¼Œå¦‚æœä¸€ä¸ª effect æŒ‡å®š`[]`ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œä½†æ˜¯åœ¨å†…éƒ¨è¯»å–`someProps`ï¼Œå®ƒå°†ä¼šä¿æŒ"çœ‹åˆ°"`someProp`çš„åˆå§‹å€¼ã€‚è§£å†³æ–¹æ¡ˆæ˜¯ç§»é™¤ä¾èµ–æ•°ç»„ï¼Œæˆ–è€…ä¿®å¤å®ƒã€‚å¦‚ä½•è§£å†³å‡½æ•°ï¼Œå’Œå…¶ä»–å¸¸è§ç­–ç•¥å°½å¯èƒ½å°‘çš„æ‰§è¡Œ effect æ²¡æœ‰æ­£ç¡®è·³è¿‡ä¾èµ–ã€‚

> æ³¨æ„ï¼šæˆ‘ä»¬æä¾›ä¸€ä¸ª`exhaustive-deps` ESLint è§„åˆ™ä½œä¸º`eslint-plugin-react-hooks`åŒ…çš„ä¸€éƒ¨åˆ†ã€‚å®ƒåœ¨ä¾èµ–æŒ‡å®šä¸æ­£ç¡®çš„æ—¶å€™è­¦å‘Šï¼Œå¹¶å»ºè®®ä¸€ä¸ªä¿®å¤ã€‚

#### å¦‚ä½•å®ç° getDerivedStateFromPropsï¼Ÿ

å°½ç®¡ä½ å¯èƒ½ä¸éœ€è¦å®ƒï¼Œåœ¨å¾ˆç½•è§çš„åœºæ™¯ä½ éœ€è¦ï¼ˆæ¯”å¦‚å®ç°ä¸€ä¸ª`<Transition>`ç»„ä»¶ï¼‰ï¼Œä½ å¯ä»¥åœ¨æ¸²æŸ“æœŸé—´æ›´æ–°çŠ¶æ€ã€‚React å°†ä¼šä½¿ç”¨æ›´æ–°çš„çŠ¶æ€ç«‹å³é‡æ–°è¿è¡Œç»„ä»¶ï¼Œåœ¨å­˜åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹åï¼Œæ‰€ä»¥å®ƒä¼šå¾ˆæ˜‚è´µã€‚
è¿™é‡Œï¼Œæˆ‘ä»¬å­˜å‚¨`row`å±æ€§çš„å‰ä¸€ä¸ªå€¼åœ¨çŠ¶æ€å˜é‡ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ¯”è¾ƒï¼š
```jsx harmony
function ScrollView({row}) {
  let [isScrollingDown, setIsScrollingDown] = useState(false);
  let [prevRow, setPrevRow] = useState(null);

  if (row !== prevRow) {
    // Row changed since last render. Update isScrollingDown.
    setIsScrollingDown(prevRow !== null && row > prevRow);
    setPrevRow(row);
  }

  return `Scrolling down: ${isScrollingDown}`;
}
```
åˆšçœ‹èµ·æ¥å¯èƒ½å¾ˆé™Œç”Ÿï¼Œä½†æ˜¯åœ¨æ¸²æŸ“ä¸­æ›´æ–°å®Œå…¨å’Œ`getDerivedStateFromProps`çš„è¡Œä¸ºä¸€è‡´ã€‚

#### æœ‰ç±»ä¼¼ forceUpdate çš„å—ï¼Ÿ 

`useState`å’Œ`useEffect` Hooks è·³ä¼æ›´æ–°ï¼Œå¦‚æœä¸‹ä¸€ä¸ªå€¼å’Œå‰ä¸€ä¸ªå€¼ä¸€æ ·ã€‚åŒæ ·çš„æ“ä½œçŠ¶æ€è°ƒç”¨`setState`ä¹Ÿä¸ä¼šå¯¼è‡´é‡æ–°æ¸²æŸ“ã€‚

é€šå¸¸ä½ ä¸åº”è¯¥åœ¨ React ä¸­æ“ä½œæœ¬åœ°çŠ¶æ€ã€‚ç„¶è€Œï¼Œä½œä¸ºä¸€ä¸ªé€ƒç”Ÿèˆ±ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªè‡ªå¢çš„è®¡æ•°å™¨å»å¼ºåˆ¶é‡æ–°æ¸²æŸ“ï¼Œå°±ç®—çŠ¶æ€æ²¡æœ‰æ”¹å˜ã€‚
```jsx harmony
  const [ignored, forceUpdate] = useReducer(x => x + 1, 0);

  function handleClick() {
    forceUpdate();
  }

```
å°½å¯èƒ½é¿å…è¿™ç§æ¨¡å¼ã€‚

#### å¯ä»¥ä¸ºå‡½æ•°ç»„ä»¶åˆ›å»º refï¼Ÿ
å°½ç®¡ä½ å¹¶ä¸éœ€è¦ç»å¸¸é›ªç‘¶è¿™ä¸ªï¼Œä½ å¯ä»¥ä½¿ç”¨`useImperativeHandle` Hook æš´éœ²ä¸€äº›ç´§æ€¥çš„æ–¹æ³•ç»™çˆ¶ç»„ä»¶ã€‚

#### å¦‚ä½•æµ‹é‡ DOM èŠ‚ç‚¹ï¼Ÿ

ä¸ºäº†æµ‹é‡ DOM èŠ‚ç‚¹çš„ä½ç½®å’Œå¤§å°ï¼Œä½ å¯ä»¥ä½¿ç”¨ callback refã€‚React å°†ä¼šè°ƒç”¨å›è°ƒå½“ ref ç»‘å®šåˆ°ä¸åŒçš„èŠ‚ç‚¹ä¸Šçš„æ—¶å€™ã€‚è¿™æ˜¯ä¸€ä¸ªå°ä¾‹å­ï¼š
```jsx harmony
function MeasureExample() {
  const [height, setHeight] = useState(0);

  const measuredRef = useCallback(node => {
    if (node !== null) {
      setHeight(node.getBoundingClientRect().height);
    }
  }, []);

  return (
    <>
      <h1 ref={measuredRef}>Hello, world</h1>
      <h2>The above header is {Math.round(height)}px tall</h2>
    </>
  );
}
```
æˆ‘ä»¬æ²¡æœ‰åœ¨è¿™ä¸ªä¾‹å­é€‰æ‹©`useRef`æ˜¯å› ä¸ºä¸€ä¸ªå¯¹è±¡ ref ä¸ä¼šæç¤ºæˆ‘ä»¬å½“å‰ ref å€¼çš„æ”¹å˜ã€‚ä½¿ç”¨ä¸€ä¸ª callback  ref ç¡®ä¿å°±ç®—å¦‚æœä¸€ä¸ªå­ç»„ä»¶æ˜¾ç¤ºåœ¨æµ‹é‡èŠ‚ç‚¹ä¹‹åï¼ˆæ¯”å¦‚ï¼Œç‚¹å‡»å“åº”ï¼‰ï¼Œæˆ‘ä»¬ä¾æ—§å¾—åˆ°å…³äºè´Ÿç»„ä»¶çš„é€šçŸ¥ï¼Œå¹¶ä¸”æ›´æ–°æµ‹é‡ã€‚

æ³¨æ„æˆ‘ä»¬ä¼ é€’`[]`ä½œä¸ºä¸€ä¸ªä¾èµ–æ•°ç»„åˆ°`useCallbak`ã€‚è¿™ç¡®ä¿æˆ‘ä»¬çš„ ref callback ä¸ä¼šåœ¨é‡æ–°æ¸²æŸ“çš„æ—¶å€™æ”¹å˜ï¼Œå¹¶ä¸”è¿™æ · React ä¸ä¼šåœ¨ä¸éœ€è¦çš„æ—¶å€™è°ƒç”¨å®ƒã€‚

å¦‚æœä½ éœ€è¦ï¼Œä½ å¯ä»¥æŠ½å–è¿™ä¸ªé€»è¾‘åˆ°ä¸€ä¸ªå¯é‡ç”¨çš„ Hookï¼š
```jsx harmony
function MeasureExample() {
  const [rect, ref] = useClientRect();
  return (
    <>
      <h1 ref={ref}>Hello, world</h1>
      {rect !== null &&
        <h2>The above header is {Math.round(rect.height)}px tall</h2>
      }
    </>
  );
}

function useClientRect() {
  const [rect, setRect] = useState(null);
  const ref = useCallback(node => {
    if (node !== null) {
      setRect(node.getBoundingClientRect());
    }
  }, []);
  return [rect, ref];
}
```

#### `const [thing, setThing] = useState()` æ„å‘³è¿™å•¥ï¼Ÿ

å¦‚æœä½ å¯¹è¿™ä¸ªè¯­æ³•ä¸ç†Ÿæ‚‰ï¼ŒæŸ¥é˜… State Hook æ–‡æ¡£çš„è§£é‡Šã€‚

### æ€§èƒ½ä¼˜åŒ–

#### å¯ä»¥åœ¨æ›´æ–°çš„æ—¶å€™è·³è¿‡ effectï¼Ÿ

å¯ä»¥ï¼ŒæŸ¥é˜…æ¡ä»¶åŒ–è§¦å‘ä¸€ä¸ª effectã€‚æ³¨æ„å¿˜è®°å»å¤„ç†æ›´æ–°ç»å¸¸å¯¼è‡´ bugï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¿™ä¸æ˜¯é»˜è®¤è¡Œä¸ºã€‚

#### ä»ä¾èµ–åˆ—è¡¨ä¸­ç¼ºçœå‡½æ•°å®‰å…¨å—ï¼Ÿ

é€šå¸¸æ¥è¯´ï¼Œä¸ã€‚
```jsx harmony
function Example({ someProp }) {
  function doSomething() {
    console.log(someProp);
  }

  useEffect(() => {
    doSomething();
  }, []); // ğŸ”´ This is not safe (it calls `doSomething` which uses `someProp`)
}
```
å¾ˆéš¾å»è®°ä½å“ªä¸€ä¸ª props æˆ–è€… state åœ¨ effect å¤–é¢çš„å‡½æ•°ä½¿ç”¨ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆ**é€šå¸¸ä½ è¦å£°æ˜ effect å‡½æ•°å†…éƒ¨éœ€è¦çš„ã€‚** å¾ˆå®¹æ˜“çœ‹å‡º effect éœ€è¦ä¾èµ–å‡½æ•°èŒƒå›´å†…çš„å“ªäº›å€¼ï¼š
```jsx harmony
function Example({ someProp }) {
  useEffect(() => {
    function doSomething() {
      console.log(someProp);
    }

    doSomething();
  }, [someProp]); // âœ… OK (our effect only uses `someProp`)
}
```
å¦‚æœåœ¨è¿™ä¹‹åï¼Œæˆ‘ä»¬ä¾æ—§ä¸ä½¿ç”¨ç»„ä»¶èŒƒå›´çš„ä»»ä½•å€¼ï¼ŒæŒ‡å®š`[]`æ˜¯å®‰å…¨çš„ï¼š
```jsx harmony
useEffect(() => {
  function doSomething() {
    console.log('hello');
  }

  doSomething();
}, []); // âœ… OK in this example because we don't use *any* values from component scope
```
å–å†³äºä½ çš„ç”¨æˆ·åœºæ™¯ï¼Œè¿˜æœ‰ä¸€äº›é€‰é¡¹è¡¨è¿°åœ¨ä¸‹é¢ï¼š

> æ³¨æ„ï¼šæˆ‘ä»¬æä¾› exhaustive-deps ESLint è§„åˆ™ä½œä¸º eslint-plugin-react-hooks åŒ…çš„ä¸€éƒ¨åˆ†ã€‚å®ƒå¸®åŠ©ä½ å»æ‰¾å‡ºä¸éœ€è¦å¤„ç†æ›´æ–°çš„ç»„ä»¶ã€‚

ä¿©çœ‹çœ‹ä¸ºä»€ä¹ˆè¿™å¾ˆé‡è¦ã€‚

å¦‚æœä½ æŒ‡å®šä¸€ä¸ªä¾èµ–åˆ—è¡¨ä½œä¸º`useEffect`ï¼Œ`useMemo`ï¼Œ`useCallback`ï¼Œæˆ–è€…`useImperativeHandle`ï¼Œå®ƒå¿…é¡»åŒ…å«å‚ä¸ React æ•°æ®æµçš„æ‰€æœ‰å€¼ã€‚åŒ…å« propsï¼Œstateï¼Œå’Œä»»ä½•ä»ä»–ä»¬æ´¾ç”Ÿå‡ºæ¥çš„ã€‚

ç¼ºçœä¸€ä¸ªå‡½æ•°çš„ä¾èµ–åˆ—è¡¨åªæœ‰åœ¨å®ƒï¼ˆæˆ–è€…å‡½æ•°é€šè¿‡å®ƒè°ƒç”¨ï¼‰æ²¡æœ‰ä»»ä½•å¯¹ propsï¼Œstate æˆ–è€…ä»ä»–ä»¬æ´¾ç”Ÿå‡ºæ¥çš„å€¼çš„å¼•ç”¨çš„æ—¶å€™ï¼Œæ‰æ˜¯å®‰å…¨çš„ã€‚è¿™ä¸ªä¾‹å­æœ‰ä¸€ä¸ª bugï¼š
```jsx harmony
function ProductPage({ productId }) {
  const [product, setProduct] = useState(null);

  async function fetchProduct() {
    const response = await fetch('http://myapi/product' + productId); // Uses productId prop
    const json = await response.json();
    setProduct(json);
  }

  useEffect(() => {
    fetchProduct();
  }, []); // ğŸ”´ Invalid because `fetchProduct` uses `productId`
  // ...
}
```
**æ¨èçš„ä¿®å¤æ–¹å¼æ˜¯ç§»åŠ¨å‡½æ•°åˆ° effect å†…éƒ¨ã€‚** è¿™è®©çœ‹å‡ºå“ªä¸€ä¸ª props æˆ–è€… state è¢«ä½¿ç”¨å¾ˆç®€å•ï¼Œå¹¶ç¡®ä¿ä»–ä»¬éƒ½è¢«å£°æ˜
```jsx harmony
function ProductPage({ productId }) {
  const [product, setProduct] = useState(null);

  useEffect(() => {
    // By moving this function inside the effect, we can clearly see the values it uses.
    async function fetchProduct() {
      const response = await fetch('http://myapi/product' + productId);
      const json = await response.json();
      setProduct(json);
    }

    fetchProduct();
  }, [productId]); // âœ… Valid because our effect only uses productId
  // ...
}
```

è¿™ä¹Ÿå…è®¸ä½ åœ¨ effect å†…éƒ¨ä½¿ç”¨ä¸€ä¸ªæœ¬åœ°å˜é‡å¤„ç†æ— åºçš„å“åº”ï¼š
```jsx harmony
  useEffect(() => {
    let ignore = false;
    async function fetchProduct() {
      const response = await fetch('http://myapi/product/' + productId);
      const json = await response.json();
      if (!ignore) setProduct(json);
    }

    fetchProduct();
    return () => { ignore = true };
  }, [productId]);
```
æˆ‘ä»¬ç§»åŠ¨å‡½æ•°åˆ° effect å†…éƒ¨ï¼Œè¿™æ ·å®ƒä¸éœ€è¦åœ¨å®ƒçš„ä¾èµ–åˆ—è¡¨ã€‚

> æç¤ºï¼šæ£€å‡ºè¿™ä¸ªå°ä¾‹å­å’Œè¿™ç¯‡æ–‡ç« äº†è§£æ›´å¤šå…³äºå…³äºä½¿ç”¨ Hooks è·å–æ•°æ®ã€‚

å¦‚æœå› ä¸ºä¸€äº›åŸå› ä½ ä¸èƒ½ç§»åŠ¨ä¸€ä¸ªå‡½æ•°åˆ°ä¸€ä¸ª effect å†…éƒ¨ï¼Œè¿™åˆä¸€äº›é€‰é¡¹ï¼š

- **ä½ å¯ä»¥å°è¯•ç§»åŠ¨è¿™ä¸ªå‡½æ•°åˆ°ä½ çš„ç»„ä»¶å¤–éƒ¨ã€‚** åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œå‡½æ•°ä¿è¯ä¸å¼•ç”¨ä»»ä½•å±æ€§å’ŒçŠ¶æ€ï¼Œå¹¶ä¸”ä¸éœ€è¦è¢«åˆ—åœ¨ä¾èµ–ä¸­ã€‚

- å¦‚æœä½ è°ƒç”¨çš„å‡½æ•°æ˜¯ä¸€ä¸ªçº¯è®¡ç®—å¹¶ä¸”åœ¨æ¸²æŸ“çš„æ—¶å€™æ˜¯å®‰å…¨è°ƒç”¨çš„ï¼Œä½ å¯èƒ½**åœ¨ effect å¤–é¢è°ƒç”¨å®ƒï¼Œ** è®© effect ä¾èµ–è¿”å›å€¼ã€‚

- ä½œä¸ºæœ€åæ‰‹æ®µï¼Œä½ å¯ä»¥**æ·»åŠ ä¸€ä¸ªå‡½æ•°åˆ° effect ä¾èµ–ä½†æ˜¯åŒ…è£¹å®ƒçš„å®šä¹‰**åˆ°`useEffect`Hookã€‚è¿™ç¡®ä¿å®ƒåœ¨æ¯ä¸€æ¬¡æ¸²æŸ“ä¸æ”¹å˜æ˜çŸ¥é“å®ƒè‡ªå·±çš„ä¾èµ–ä¹Ÿæ”¹å˜ã€‚

```jsx harmony
function ProductPage({ productId }) {
  // âœ… Wrap with useCallback to avoid change on every render
  const fetchProduct = useCallback(() => {
    // ... Does something with productId ...
  }, [productId]); // âœ… All useCallback dependencies are specified

  return <ProductDetails fetchProduct={fetchProduct} />;
}

function ProductDetails({ fetchProduct }) {
  useEffect(() => {
    fetchProduct();
  }, [fetchProduct]); // âœ… All useEffect dependencies are specified
  // ...
}
```
æ³¨æ„åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¿æŒå‡½æ•°åœ¨ä¾èµ–åˆ—è¡¨ï¼Œè¿™ç¡®ä¿`productPage`çš„`productId`å±æ€§çš„æ”¹å˜è‡ªåŠ¨è§¦å‘`productDetails`ç»„ä»¶çš„é‡æ–°è·å–ã€‚

#### å¦‚æœæˆ‘çš„ effect ä¾èµ–å˜åŠ¨é¢‘ç¹è¯¥æ€ä¹ˆåŠï¼Ÿ

æœ‰æ—¶å€™ï¼Œä½ çš„ effect å¯èƒ½ä½¿ç”¨æ”¹å˜å¾ˆé¢‘ç¹çš„çŠ¶æ€ã€‚ä½ å¯èƒ½å°è¯•å»ä»ä¾èµ–åˆ—è¡¨ç¼ºçœè¿™ä¸ªçŠ¶æ€ï¼Œä½†æ˜¯è¿™ç»å¸¸å¯¼è‡´ bugã€‚
```jsx harmony
function Counter() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    const id = setInterval(() => {
      setCount(count + 1); // This effect depends on the `count` state
    }, 1000);
    return () => clearInterval(id);
  }, []); // ğŸ”´ Bug: `count` is not specified as a dependency

  return <h1>{count}</h1>;
}
```
ç©ºçš„ä¾èµ–é›†åˆï¼Œ`[]`ï¼Œæ„å‘³ç€ effect åªä¼šè¿è¡Œä¸€æ¬¡ï¼Œå½“ç»„ä»¶æŒ‚è½½çš„æ—¶å€™ï¼Œè€Œä¸æ˜¯æ¯æ¬¡æ¸²æŸ“ã€‚è¿™ä¸ªé—®é¢˜åœ¨`setinterval`å›è°ƒå†…éƒ¨ï¼Œ`count`å€¼æ²¡æœ‰æ”¹å˜ï¼Œå› ä¸ºæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªé—­åŒ…ï¼Œå®ƒçš„`count`å€¼ä¸º`0`ï¼Œå½“è¿™ä¸ª effect å›è°ƒæ‰§è¡Œçš„æ—¶å€™ã€‚æ¯ç§’ï¼Œå›è°ƒéƒ½ä¼šè°ƒç”¨`setCount(0 + 1)`ï¼Œæ‰€ä»¥ï¼Œè®¡æ•°å™¨æ°¸è¿œä¸ä¼šå¤§äº 1ã€‚

æŒ‡å®š`[count]`ä½œä¸ºä¾èµ–åˆ—è¡¨å¯ä»¥ä¿®å¤è¿™ä¸ª bugï¼Œä½†æ˜¯å¯¼è‡´å®šæ—¶å™¨åœ¨æ¯ä¸€æ¬¡æ”¹å˜éƒ½é‡æ–°è®¾ç½®ã€‚å®é™…ä¸Šï¼Œæ¯ä¸€æ¬¡`setInterval`éƒ½ä¼šæœ‰ä¸€æ¬¡æœºä¼šåœ¨æ¸…ç†å‰è¢«æ‰§è¡Œï¼ˆå’Œ`setTimeout`ç±»ä¼¼ï¼‰è¿™å¯èƒ½ä¸æ˜¯å¸Œæœ›çš„ã€‚ä¸ºäº†ä¿®å¤å®ƒï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`setState çš„å‡½æ•°æ–¹å¼æ›´æ–°æ ¼å¼`ã€‚å®ƒè®©æˆ‘ä»¬æŒ‡å®šçŠ¶æ€æ€æ ·ä¸å¼•ç”¨å½“å‰çŠ¶æ€æ”¹å˜ã€‚
```jsx harmony
function Counter() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    const id = setInterval(() => {
      setCount(c => c + 1); // âœ… This doesn't depend on `count` variable outside
    }, 1000);
    return () => clearInterval(id);
  }, []); // âœ… Our effect doesn't use any variables in the component scope

  return <h1>{count}</h1>;
}

```
`setCount`è¡¨ç¤ºä¿è¯æ˜¯ç¨³å®šçš„ï¼Œæ‰€ä»¥ç¼ºçœæ˜¯å®‰å…¨çš„ã€‚

ç°åœ¨ï¼Œ`setInterval`å›è°ƒæ‰§è¡Œä¸€ç§’ä¸€æ¬¡ï¼Œä½†æ˜¯æ¯æ¬¡å†…éƒ¨å—²ç”¨`setCount`éƒ½æ˜¯ç”¨æ›´æ–°çš„`count`å€¼ï¼ˆåœ¨å›è°ƒå†…å«åš`c`ï¼‰ã€‚

åœ¨æ›´å¤æ‚çš„åœºæ™¯ï¼ˆæ¯”å¦‚ï¼Œå¦‚æœçŠ¶æ€ä¾èµ–å…¶ä»–çŠ¶æ€ï¼‰ï¼Œå°è¯•ç§»åŠ¨çŠ¶æ€æ›´æ–°é€»è¾‘åˆ° effect ä¹‹å¤–ï¼Œä½¿ç”¨`useReducer`Hookã€‚è¿™ç¯‡æ–‡ç« æä¾›ä¸€ä¸ªæ€æ ·åšçš„ä¾‹å­ã€‚**useReducer ä¸­çš„åˆ†å‘å‡½æ•°çš„è¡¨ç¤ºæ€»æ˜¯ç¨³å®šçš„** -- å°±ç®—åˆ†å‘å‡½æ•°åœ¨ç»„ä»¶å†…å£°æ˜å¹¶è¯»å–å®ƒçš„å±æ€§ã€‚

æœ€åæ–¹æ¡ˆï¼Œå¦‚æœä½ æƒ³è¦ä¸€è¯·ç±»å†…çš„`this`ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ª ref å»ä¿å­˜å¯å˜å˜é‡ã€‚åˆ™ä½ å¯ä»¥å†™å…¥å’Œè¯»å–å®ƒï¼Œæ¯”å¦‚ï¼š
```jsx harmony
function Example(props) {
  // Keep latest props in a ref.
  let latestProps = useRef(props);
  useEffect(() => {
    latestProps.current = props;
  });

  useEffect(() => {
    function tick() {
      // Read latest props at any time
      console.log(latestProps.current);
    }

    const id = setInterval(tick, 1000);
    return () => clearInterval(id);
  }, []); // This effect never re-runs
}
```
åªæœ‰åœ¨ä½ æ‰¾ä¸åˆ°æ›´å¥½çš„æ›¿ä»£çš„æ—¶å€™å¯ä»¥è¿™ä¹ˆåšï¼Œå› ä¸ºä¾èµ–å¯å˜è®©ç»„ä»¶ä¸å¯é¢„æ–™ã€‚å¦‚æœæœ‰ä¸€ä¸ªæŒ‡å®šçš„æ¨¡å¼ä¸èƒ½å¾ˆå¥½çš„è½¬åŒ–ï¼Œä½¿ç”¨å¯æ‰§è¡Œçš„ä»£ç æä¸€ä¸ª issueï¼Œæˆ‘ä»¬ä¼šå°è¯•å»å¸®åŠ©ã€‚ 

#### æˆ‘è¯¥å¦‚ä½•å®ç° shouldComponentUpdateï¼Ÿ

ä½ å¯ä»¥ä½¿ç”¨`React.memo`å»æµ…æ¯”è¾ƒå®ƒçš„å±æ€§ï¼š
```jsx harmony
const Button = React.memo((props) => {
  // your component
});
```
è¿™ä¸æ˜¯ä¸€ä¸ª Hookï¼Œå› ä¸ºå®ƒä¸åƒ Hook é‚£æ ·ç»„åˆã€‚`React.memo`å’Œ`Pure Component`ç›¸åŒï¼Œä½†æ˜¯å®ƒåªæ¯”è¾ƒå±æ€§ã€‚ï¼ˆä½ ä¹Ÿå¯ä»¥æ·»åŠ ä¸€ä¸ªç¬¬äºŒå‚æ•°å»æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„æ¯”è¾ƒå‡½æ•°ï¼Œä½¿ç”¨æ—§çš„å’Œæ–°çš„å±æ€§ã€‚å¦‚æœè¿”å› trueï¼Œæ›´æ–°å°±ä¼šè¢«è·³è¿‡ï¼‰ã€‚

`React.memo`ä¸æ¯”è¾ƒçŠ¶æ€æ˜¯å› ä¸ºæ²¡æœ‰å•ä¸€çš„çŠ¶æ€å¯¹è±¡æ¯”è¾ƒã€‚ä½†æ˜¯ä½ ä¹Ÿå¯ä»¥åˆ›å»ºå­å­™çº¯ç»„ä»¶ï¼Œæˆ–è€…ä½¿ç”¨`useMemo`ä¼˜åŒ–ç‹¬ç«‹çš„å­å­™ã€‚

#### æ€ä¹ˆè®°ä½è®¡ç®—ï¼Ÿ

`useMemo` Hook è®©ä½ åœ¨å¤šæ¬¡æ¸²æŸ“ä¹‹é—´ç¼“å­˜è®¡ç®—ï¼Œé€šè¿‡"è®°ä½"èµ·é‚£ä¸€æ¬¡è®¡ç®—ï¼š
```jsx harmony
const memoizedValue = useMemo(() => computeExpensiveValue(a, b), [a, b]);
```
è¿™ä¸ªä»£ç è°ƒç”¨`computeExpensiveValue(a, b)`ï¼Œä½†æ˜¯å¦‚æœä¾èµ–`[a, b]`ä»ä¸Šä¸€æ¬¡å€¼å¼€å§‹å°±æ²¡æœ‰æ”¹å˜ï¼Œ`useMemo`ç¬¬äºŒæ¬¡è·³è¿‡è°ƒç”¨å®ƒï¼Œå¹¶ç®€å•ä½¿ç”¨å‰ä¸€ä¸ªå€¼è¿”å›ã€‚

è®°ä½ä¼ é€’ç»™`useMemo`çš„å‡½æ•°åœ¨æ¸²æŸ“æœŸé—´æ‰§è¡Œã€‚ä¸è¦åšä½ ä¸ä¼šåœ¨æ¸²æŸ“æœŸé—´åšçš„ä»»ä½•äº‹æƒ…ã€‚æ¯”å¦‚ï¼Œå±äº`useEffect`çš„å‰¯ä½œç”¨ï¼Œä¸æ˜¯`useMemo`ã€‚

**ä½ å¯èƒ½ä¾èµ– useMemo ä½œä¸ºæ€§èƒ½ä¼˜åŒ–ï¼Œä¸æ˜¯è¯­æ³•ä¿è¯ã€‚** åœ¨æœªæ¥ï¼ŒReact å¯èƒ½é€‰æ‹©ä¸€äº›ä¹‹å‰è®°å½•çš„å€¼å’Œè®¡ç®—ä»–ä»¬åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“ï¼Œæ¯”å¦‚ï¼Œé‡Šæ”¾ä¸å†å±å¹•å†…çš„ç»„ä»¶çš„å†…å­˜ã€‚åœ¨æ²¡æœ‰`useMemo`çš„æƒ…å†µä¸‹ä½ ç¼–å†™çš„ä»£ç ä¹Ÿèƒ½æ‰§è¡Œ -- å¹¶æ·»åŠ å®ƒåˆ°ä¼˜åŒ–æ€§èƒ½ã€‚ï¼ˆåœ¨å¾ˆå°‘è§çš„åœºæ™¯ï¼Œå½“ä¸€ä¸ªå€¼å¿…é¡»ä¸è¢«é‡æ–°è®¡ç®—ï¼Œä½ å¯ä»¥ lazily initialize ä¸€ä¸ª refï¼‰ã€‚

æ–¹ä¾¿çš„ï¼Œ`useMemo`ä¹Ÿè®©ä½ è·³è¿‡æ˜‚è´µçš„å­ç»„ä»¶é‡æ¸²æŸ“ï¼š
```jsx harmony
function Parent({ a, b }) {
  // Only re-rendered if `a` changes:
  const child1 = useMemo(() => <Child1 a={a} />, [a]);
  // Only re-rendered if `b` changes:
  const child2 = useMemo(() => <Child2 b={b} />, [b]);
  return (
    <>
      {child1}
      {child2}
    </>
  )
}
```
æ³¨æ„è¿™ä¸ªå®ç°æ— æ³•åœ¨å¾ªç¯å†…å·¥ä½œæ²¡å› ä¸º Hook è°ƒç”¨æ— æ³•åœ¨å¾ªç¯å†…ã€‚ä½†ä½ å¯ä»¥ä¸ºåˆ—è¡¨é¡¹æŠ½å–ä¸€ä¸ªç‹¬ç«‹çš„ç»„ä»¶ï¼Œå¹¶è°ƒç”¨`useMemo`ã€‚

#### å¦‚ä½•æƒ°æ€§åˆ›å»ºæ˜‚è´µçš„å¯¹è±¡ï¼Ÿ
`useMemo`è®©ä½ è®°ä½ä¸€ä¸ªæ˜‚è´µçš„è®¡ç®—ï¼Œå¦‚æœä¾èµ–éƒ½æ˜¯ç›¸åŒçš„ã€‚ç„¶è€Œï¼Œå®ƒåªä½œä¸ºä¸€ä¸ªçªé—¨ä½¿ç”¨ï¼Œå¹¶ä¸”ä¸ä¿è¯è®¡ç®—ä¸ä¼šé‡æ–°æ‰§è¡Œã€‚ä½†æ˜¯æœ‰æ—¶å€™ä½ éœ€è¦ä¿è¯ä¸€ä¸ªå¯¹è±¡åªåˆ›å»ºä¸€æ¬¡ã€‚

ç¬¬ä¸€ä¸ªå¸¸è§çš„ä½¿ç”¨åœºæ™¯å°±æ˜¯å½“åˆ›å»ºä¸€ä¸ªå‡ºäº‹çŠ¶æ€å¾ˆæ˜‚è´µï¼š
```jsx harmony
function Table(props) {
  // âš ï¸ createRows() is called on every render
  const [rows, setRows] = useState(createRows(props.count));
  // ...
}
```
ä¸ºäº†é¿å…é‡æ–°åˆ›å»ºå¿½ç•¥å‡ºäº‹çŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ é€’ä¸€ä¸ªå‡½æ•°åˆ°`useState`ï¼š
```jsx harmony
function Table(props) {
  // âœ… createRows() is only called once
  const [rows, setRows] = useState(() => createRows(props.count));
  // ...
}
```
React å°†ä¼šåªè°ƒç”¨è¿™ä¸ªå‡½æ•°ä¸€æ¬¡ï¼Œåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™ï¼ŒæŸ¥çœ‹`useState` API
ç´¢å¼•ã€‚

**ä½ å¯èƒ½å¶å°”ä¹Ÿéœ€è¦é¿å…é‡æ–°åˆ›å»º useRef() åˆå§‹çŠ¶æ€**ã€‚æ¯”å¦‚ï¼Œå¯èƒ½ä½ è¦ä¿è¯ä¸€äº›é‡è¦çš„ç±»å®ä¾‹åªåˆ›å»ºä¸€æ¬¡ï¼š
```jsx harmony
function Image(props) {
  // âš ï¸ IntersectionObserver is created on every render
  const ref = useRef(new IntersectionObserver(onIntersect));
  // ...
}
```
`useRef`**ä¸**æ¥æ”¶ä¸€ä¸ªæŒ‡å®šçš„å‡½æ•°ï¼Œåƒ`useState`ã€‚ç›¸åï¼Œä½ å¯ä»¥ç¼–å†™ä½ è‡ªå·±çš„å‡½æ•°æƒ°æ€§åˆ›å»ºå’Œè®¾ç½®ï¼š
```jsx harmony
function Image(props) {
  const ref = useRef(null);

  // âœ… IntersectionObserver is created lazily once
  function getObserver() {
    if (ref.current === null) {
      ref.current = new IntersectionObserver(onIntersect);
    }
    return ref.current;
  }

  // When you need it, call getObserver()
  // ...
}

```

è¿™é¿å…åˆ›å»ºä¸€ä¸ªæ˜‚è´µçš„å¯¹è±¡ï¼Œç›´åˆ°ç¬¬ä¸€æ¬¡å®ƒçœŸçš„éœ€è¦ã€‚å¦‚æœä½ ä½¿ç”¨ Flow æˆ–è€… TypeScriptï¼Œä½ ä¹Ÿå¯ä»¥æ–¹ä¾¿çš„ç»™`getObserver`ä¸€ä¸ªéå¯ç©ºç±»å‹ã€‚

#### Hooks ä¼šå› ä¸ºåœ¨ render åˆ›å»ºå‡½æ•°å˜æ…¢å—ï¼Ÿ
ä¸ã€‚åœ¨ç°ä»£æµè§ˆå™¨ï¼Œé—­åŒ…çš„åŸå§‹æ€§èƒ½å’Œç±»ç›¸æ¯”ï¼Œæ²¡æœ‰å¾ˆå¤§çš„å·®åˆ«ï¼Œé™¤éåœ¨æç«¯çš„æƒ…å†µä¸‹ã€‚

æ­¤å¤–ï¼Œè€ƒè™‘åˆ° Hooks çš„è®¾ç½®åœ¨ä¸¤ä¸ªæ–¹é¢æ›´æœ‰æ•ˆï¼š
- Hooks é¿å…å¤§é‡ç±»çš„å¼€é”€ï¼Œæ¯”å¦‚åˆ›å»ºç±»å®ä¾‹å’Œåœ¨æ„é€ å™¨å†…ç»‘å®šäº‹ä»¶å¤„ç†çš„æ¶ˆè€—
- **æƒ¯ç”¨ä»£ç ä½¿ç”¨ Hooks ä¸éœ€è¦æ·±ç»„ä»¶æ ‘å†…åµŒ**ï¼Œé˜²æ­¢ä½¿ç”¨ higher-order componentï¼Œrender propsï¼Œå’Œ contextã€‚æ›´å°çš„ç»„ä»¶æ ‘ï¼ŒReact å·¥ä½œæ›´å°‘ã€‚

ä¸€èˆ¬æ¥è¯´ï¼ŒReact æ€§èƒ½å…³å¿ƒè¡Œå†…å‡½æ•°å’Œæ€æ ·ä¼ é€’æ–°çš„å›è°ƒåˆ°æ¯ä¸€ä¸ªå­ç»„ä»¶æ¸²æŸ“æ‰“ç ´`shouldComponentUpdate`ä¼˜åŒ–ã€‚Hooks ä»æ ‘çš„æ–¹é¢è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

- `useCallback` Hook ç„¶ä½ ä¿æŒç›¸åŒçš„å›è°ƒå¼•ç”¨ï¼Œåœ¨é‡æ¸²æŸ“ä¹‹é—´ï¼Œè¿™æ ·`shouldComponentUpdate`ç»§ç»­å·¥ä½œï¼š
```jsx harmony
// Will not change unless `a` or `b` changes
const memoizedCallback = useCallback(() => {
  doSomething(a, b);
}, [a, b]);
```
- `useMemo` Hook è®©å®ƒæ›´å®¹æ˜“æ§åˆ¶ï¼Œå½“ç‹¬ç«‹å­å­™æ›´æ–°ï¼Œå‡å°‘çº¯ç»„ä»¶çš„éœ€è¦ã€‚

- æœ€åï¼Œ`useReducer` Hook å‡å°‘æ·±å±‚ä¼ é€’å›è°ƒçš„éœ€è¦ï¼Œå°±åƒä¸‹é¢è§£é‡Šçš„ã€‚

#### æ€ä¹ˆé¿å…å‘ä¸‹ä¼ é€’å›è°ƒï¼Ÿ

#### æ€ä¹ˆä» useCallback è¯»å–ç»å¸¸æ”¹å˜çš„å€¼ï¼Ÿ

> æ³¨æ„ï¼š
> æˆ‘ä»¬æ¨èåœ¨ä¸Šä¸‹æ–‡å‘ä¸‹ä¼ é€’åˆ†å‘ï¼Œè€Œä¸æ˜¯å±æ€§ä¸­ç‹¬ç«‹çš„å›è°ƒã€‚ä¸‹é¢çš„å®ç°åªæ˜¯åœ¨è¿™é‡Œæç¤ºå®Œå¤‡æ€§å’Œä½œä¸ºé€ƒç”Ÿèˆ±ã€‚
> åŒæ—¶æ³¨æ„è¿™ä¸ªæ¨¡å¼å¯èƒ½åœ¨`concurrent mode`å¯¼è‡´é—®é¢˜ã€‚æˆ‘ä»¬è®¡åˆ’åœ¨æœªæ¥æä¾›æ›´äººæ€§åŒ–çš„æ›¿ä»£ï¼Œä½†æ˜¯ç°åœ¨æœ€å®‰å…¨çš„è§£å†³æ–¹æ¡ˆæ˜¯æ€»æ˜¯æ— æ•ˆå›è°ƒï¼Œå¦‚æœä¸€äº›å€¼çš„ä¾èµ–æ”¹å˜äº†ã€‚

åœ¨ä¸€äº›ç½•è§çš„åœºæ™¯ï¼Œä½ éœ€è¦è®°ä½ä¸€ä¸ª`userCallback`ä½¿ç”¨çš„å›è°ƒï¼Œä½†æ˜¯è®°å½•å¹¶ä¸å·¥ä½œï¼Œå› ä¸ºå†…éƒ¨çš„å‡½æ•°ç»å¸¸è¢«å†²åˆ›å»ºã€‚å¦‚æœä½ è¦è®°ä½çš„å‡½æ•°æ˜¯ä¸€ä¸ªäº‹ä»¶å¤„ç†å™¨ï¼Œå¹¶ä¸”ä¸å†æ¸²æŸ“æœŸé—´ä½¿ç”¨ï¼Œä½ å¯ä»¥ä½¿ç”¨ ref ä½œä¸ºä¸€ä¸ªå®ä¾‹å˜é‡ï¼Œæ‰‹åŠ¨ä¿å­˜æœ€æ–°æäº¤çš„å€¼åˆ°å®ƒã€‚
```jsx harmony
function Form() {
  const [text, updateText] = useState('');
  const textRef = useRef();

  useEffect(() => {
    textRef.current = text; // Write it to the ref
  });

  const handleSubmit = useCallback(() => {
    const currentText = textRef.current; // Read it from the ref
    alert(currentText);
  }, [textRef]); // Don't recreate handleSubmit like [text] would do

  return (
    <>
      <input value={text} onChange={e => updateText(e.target.value)} />
      <ExpensiveTree onSubmit={handleSubmit} />
    </>
  );
}
```
è¿™æ˜¯ä¸€ä¸ªç›¸å½“å¤æ‚çš„æ¨¡å¼ï¼Œä½†æ˜¯å®ƒæ˜¾ç¤ºä½ å¯ä»¥è¿™ä¹ˆä¼˜åŒ–ï¼Œå¦‚æœä½ éœ€è¦å®ƒã€‚å®ƒä¼šæ›´å®¹æ˜“å¿å—ï¼Œå¦‚æœä½ å°†å®ƒæŠ½å–åˆ°ä¸€ä¸ªè‡ªå®šä¹‰ Hookã€‚
```jsx harmony
function Form() {
  const [text, updateText] = useState('');
  // Will be memoized even if `text` changes:
  const handleSubmit = useEventCallback(() => {
    alert(text);
  }, [text]);

  return (
    <>
      <input value={text} onChange={e => updateText(e.target.value)} />
      <ExpensiveTree onSubmit={handleSubmit} />
    </>
  );
}

function useEventCallback(fn, dependencies) {
  const ref = useRef(() => {
    throw new Error('Cannot call an event handler while rendering.');
  });

  useEffect(() => {
    ref.current = fn;
  }, [fn, ...dependencies]);

  return useCallback(() => {
    const fn = ref.current;
    return fn();
  }, [ref]);
}
```
è¿™ä¸¤ç§åœºæ™¯ï¼Œæˆ‘ä»¬**éƒ½ä¸æ¨èè¿™ç§æ¨¡å¼**å¹¶ä¸”åªä¸ºäº†å®Œå¤‡æ€§å±•ç¤ºå®ƒã€‚ç›¸åï¼Œæœ€å¥½é¿å…å‘ä¸‹ä¼ é€’å›è°ƒã€‚

### Hook åº•å±‚

#### React å¦‚ä½•å…³è” Hook è°ƒç”¨å’Œç»„ä»¶ï¼Ÿ

React è·Ÿè¸ªå½“å‰æ¸²æŸ“çš„ç»„ä»¶ã€‚æ„Ÿè°¢ Hooks çš„è§„åˆ™ï¼Œæˆ‘ä»¬çŸ¥é“ Hooks åªåœ¨ React ç»„ä»¶å†…è°ƒç”¨ï¼ˆæˆ–è€…è‡ªå®šä¹‰ Hooks -- ä¹Ÿåªåœ¨ React ç»„ä»¶å†…è°ƒç”¨ï¼‰ã€‚

æœ‰ä¸€ä¸ªå†…éƒ¨çš„"å†…å­˜å•å…ƒ"åˆ—è¡¨å…³è”æ¯ä¸€ä¸ªç»„ä»¶ã€‚ä»–ä»¬åªæ˜¯ JavaScript å¯¹è±¡ï¼Œæˆ‘ä»¬è¾“å…¥ä¸€ä¸‹æ•°æ®ã€‚å½“ä½ è°ƒç”¨ä¸€ä¸ª Hookï¼Œæ¯”å¦‚`useState()`ï¼Œå®ƒè¯»å–å½“å‰ä½†æ„¿æˆ–è€…åˆå§‹åŒ–å®ƒï¼Œåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼ˆï¼Œç„¶åç§»åŠ¨æŒ‡é’ˆåˆ°ä¸‹ä¸€ä¸ªï¼‰ã€‚è¿™æ˜¯å¤šä¸ª`useState()`è°ƒç”¨æ¯ä¸€ä¸ªéƒ½æœ‰ç‹¬ç«‹æœ¬åœ°çŠ¶æ€çš„åŸå› ã€‚

#### Hooks çš„å…ˆå‰çš„è‰ºæœ¯æ˜¯å•¥ï¼Ÿ

Hooks ç»¼åˆå¤šä¸ªä¸åŒæ¥æºçš„æƒ³æ³•ã€‚

- æˆ‘ä»¬å…³äºå‡½æ•° API è€çš„ç»éªŒåœ¨ react-future åº“ã€‚

- React ç¤¾åŒºå…³äº render props API çš„ç»éªŒï¼ŒåŒ…å« Ryan Florence çš„ Reaction Componentã€‚

- Dominic Gannaway çš„ä½¿ç”¨å…³é”®å­—ä½œä¸ºæ¸²æŸ“å±æ€§è¯­æ³•ç³–çš„ææ¡ˆã€‚

- DisplayScript ä¸­çŠ¶æ€å˜é‡å’ŒçŠ¶æ€å•å…ƒã€‚

- ReasonReact ä¸­çš„ Reducer componentsã€‚

- Rx ä¸­çš„ Subscriptions

- Multicore OCaml ä¸­çš„ Algebraic effect 

Sebastian MarkbÃ¥ge æå‡ºäº† Hooks çš„æœ€åˆè®¾è®¡ï¼Œç„¶åè¢« Andrew Clarkï¼ŒSophie Alpertï¼ŒDominic Gannawayï¼Œå’Œ React team ä¸­çš„å…¶ä»–æˆå‘˜é‡æ–°å®šä¹‰ã€‚

